---
sidebar_position: 3
sidebar_label: "1. Monolith server"
---

The repository for this section is located at branch **[1_Monolith_architecture](https://github.com/highlander-spirou/microgo/tree/1_Monolith_architecture)**

# The starting point

We will start with a very simple Flask application, that we normally see in most Youtube tutorials. 

The Flask app contains 4 routes that is registered at `index.py`. Simple & straightfoward route logic are baked into the `index.py` while the complicated ones are separated into `controllers`. Reusable codes are placed at `modules` (or `libs`, `utils`, ..., whatever you please) and `middlewares` (reusable code applied directly to the `request` object)

## Directory tree:


```mdx title="Monolith"
â”‚   # Seperate the controller when the logic gets complicates (and reduce the import of `index.py`)
â”œâ”€â”€ controllers
â”‚   â”œâ”€â”€ download_ctrl.py
â”‚   â””â”€â”€ upload_ctrl.py
â”‚
â”‚   # Reusable logic (`user_authentication`) 
â”œâ”€â”€ middleware
â”‚   â””â”€â”€ authenticate_route.py
â”‚
â”‚   # Small pieces of code with specific functionality
â”œâ”€â”€ modules
â”‚   â”œâ”€â”€ auth
â”‚   â”œâ”€â”€ config
â”‚   â”œâ”€â”€ file_access
â”‚   â”œâ”€â”€ img_process
â”‚   â”œâ”€â”€ log
â”‚   â””â”€â”€ errors
â”‚   
â”‚   # To store application logs
â”œâ”€â”€ logs
â”‚ 
â”‚   # This is server's .env (contains database host, ports and access identifier)  
â”œâ”€â”€ .env
â”œâ”€â”€ pyproject.toml
â”œâ”€â”€ instantiation.py
â”œâ”€â”€ index.py
â””â”€â”€ wsgi.py
```

```mdx title="Top level file"
â”‚   # Files for containerization  
â”œâ”€â”€ pyproject.toml
â”œâ”€â”€ poetry.lock
â”‚   # Cluster .env file (for secrets like root user)  
â”œâ”€â”€ .env
â”‚
â”‚   # This folder responsible for initialize the creation of desired state of the database. 
â”œâ”€â”€ bootstrap
â”‚   â”œâ”€â”€ auth
â”‚   â””â”€â”€ errors
â”‚
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ .dockerignore
â””â”€â”€ docker-compose.yml
```

## Databases

The two databases will be declared in the `docker-compose.yml`. Here, we state that the two database will be registered to `host` network, so that the server could refer to their IP address as `localhost`.

We will utilize the `docker-entrypoint-initdb.d` to finalize the desired state the databases (including create access users, create tables, collections and seeded data). In production environment, this folder with be RIGHT BEFORE BUILD TIME since this contains confidential data.

:::tip

More about Docker networking see **[Docker networking tutorial](/docs/tutorial-basics/docker-network)**

:::


## The monolith server

To mimic a crowded website, the image process function will be throttled for 5s. Eventhough the entry file is called `wsgi.py`, we will run a bare Flask development server without any WSGI interface

Run this command ðŸ‘‡

```bash
docker compose up -d
cd monolith && python wsgi.py
```

*Test results*

![Postman test result for monolith server](/img/postman_test_monolith.png)


<!-- <p style="font-size: large; font-weight: 600;">Boom ðŸ’¥ !!! Now you have a cool webserver up and running ðŸ˜Ž</p> -->
<p style={{fontSize: "1.7em", fontWeight: 600}}>Now you have a web server up and running !!!</p>


